<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Camera App with Lock</title>
<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  background:black;color:white;
  touch-action:none;font-family:system-ui
}
#lockScreen{
  position:fixed;inset:0;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  background:#000;z-index:1000
}
#display{
  font-size:2em;width:220px;
  text-align:center;margin-bottom:20px
}
.btn{width:60px;height:60px;margin:4px}
#cameraContainer{position:fixed;inset:0;display:none}
video{width:100%;height:100%;object-fit:cover}
#overlayImage{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  max-width:80%;max-height:80%;
  display:none;touch-action:none;z-index:5
}
#controls{
  position:fixed;bottom:15px;left:15px;
  display:none;gap:10px;z-index:10
}
</style>
</head>
<body>

<div id="lockScreen">
  <h2>Enter Password</h2>
  <input id="display" type="password" readonly>
  <div>
    <button class="btn" onclick="press('1')">1</button>
    <button class="btn" onclick="press('2')">2</button>
    <button class="btn" onclick="press('3')">3</button><br>
    <button class="btn" onclick="press('4')">4</button>
    <button class="btn" onclick="press('5')">5</button>
    <button class="btn" onclick="press('6')">6</button><br>
    <button class="btn" onclick="press('7')">7</button>
    <button class="btn" onclick="press('8')">8</button>
    <button class="btn" onclick="press('9')">9</button><br>
    <button class="btn" onclick="clearDisplay()">C</button>
    <button class="btn" onclick="press('0')">0</button>
    <button class="btn" onclick="checkPassword()">OK</button>
  </div>
</div>

<div id="cameraContainer">
  <video id="video" autoplay playsinline muted></video>
</div>

<img id="overlayImage">

<div id="controls">
  <input id="zoomSlider" type="range">
  <input id="opacitySlider" type="range" min="0.1" max="1" step="0.01" value="1">
  <button id="photoBtn">Choose Photo</button>
  <button id="linkZoomBtn">Link Zoom</button>
</div>

<script>
/* -------- DOM -------- */
const lockScreen=document.getElementById("lockScreen");
const display=document.getElementById("display");
const cameraContainer=document.getElementById("cameraContainer");
const controls=document.getElementById("controls");
const video=document.getElementById("video");
const overlay=document.getElementById("overlayImage");
const zoomSlider=document.getElementById("zoomSlider");
const opacitySlider=document.getElementById("opacitySlider");
const photoBtn=document.getElementById("photoBtn");
const linkZoomBtn=document.getElementById("linkZoomBtn");

/* -------- LOCK -------- */
const PASSWORD="3490"; let input="";
function press(n){input+=n;display.value=input}
function clearDisplay(){input="";display.value=""}
function checkPassword(){
  if(input===PASSWORD){
    lockScreen.style.display="none";
    cameraContainer.style.display="block";
    controls.style.display="flex";
    startCamera();
  }else{alert("Wrong password");clearDisplay()}
}

/* -------- TRANSFORMS -------- */
let originX=0,originY=0,scale=1,rotation=0;
let tX=0,tY=0,tScale=1,tRot=0;
function lerp(a,b,t){return a+(b-a)*t}
function applyTransform(){
  overlay.style.transform=
    `translate(-50%,-50%) translate(${originX}px,${originY}px)
     scale(${scale}) rotate(${rotation}deg)`
}
(function animate(){
  originX=lerp(originX,tX,.15);
  originY=lerp(originY,tY,.15);
  scale=lerp(scale,tScale,.15);
  rotation=lerp(rotation,tRot,.15);
  applyTransform();
  requestAnimationFrame(animate);
})();

/* -------- CAMERA -------- */
let videoTrack=null,supportsZoom=false,linkZoom=false;
async function startCamera(){
  const stream=await navigator.mediaDevices.getUserMedia({
    video:{facingMode:{exact:"environment"}}
  });
  video.srcObject=stream;
  videoTrack=stream.getVideoTracks()[0];
  const cap=videoTrack.getCapabilities();
  if(cap.zoom){
    supportsZoom=true;
    zoomSlider.min=cap.zoom.min;
    zoomSlider.max=cap.zoom.max;
    zoomSlider.step=cap.zoom.step;
    zoomSlider.value=cap.zoom.min;
    zoomSlider.oninput=()=>videoTrack.applyConstraints({
      advanced:[{zoom:+zoomSlider.value}]
    });
  }
}

/* -------- CONTROLS -------- */
opacitySlider.oninput=()=>overlay.style.opacity=opacitySlider.value;
photoBtn.onclick=()=>{
  const i=document.createElement("input");
  i.type="file";i.accept="image/*";
  i.onchange=e=>{
    overlay.src=URL.createObjectURL(e.target.files[0]);
    overlay.style.display="block";
    tX=tY=0;tScale=1;tRot=0;
  };
  i.click();
};
linkZoomBtn.onclick=()=>{
  linkZoom=!linkZoom;
  linkZoomBtn.textContent=linkZoom?"Unlink Zoom":"Link Zoom";
};

/* -------- TOUCH -------- */
let lastTouch=null,startDist=0,startAng=0;
overlay.addEventListener("touchstart",e=>{
  if(e.touches.length===1)lastTouch=e.touches[0];
  if(e.touches.length===2){
    const[a,b]=e.touches;
    startDist=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
    startAng=Math.atan2(a.clientY-b.clientY,a.clientX-b.clientX)*180/Math.PI;
  }
});
overlay.addEventListener("touchmove",e=>{
  e.preventDefault();
  if(e.touches.length===1 && lastTouch && !linkZoom){
    tX+=e.touches[0].clientX-lastTouch.clientX;
    tY+=e.touches[0].clientY-lastTouch.clientY;
    lastTouch=e.touches[0];
  }
  if(e.touches.length===2){
    const[a,b]=e.touches;
    const d=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
    const f=d/startDist;
    tScale=Math.max(.1,Math.min(tScale*f,10));
    if(!linkZoom){
      const ang=Math.atan2(a.clientY-b.clientY,a.clientX-b.clientX)*180/Math.PI;
      tRot+=ang-startAng;startAng=ang;
    }
    if(linkZoom && supportsZoom){
      const z=Math.max(zoomSlider.min,Math.min(tScale,zoomSlider.max));
      videoTrack.applyConstraints({advanced:[{zoom:z}]});
      zoomSlider.value=z;
    }
    startDist=d;
  }
},{passive:false});
</script>
</body>
</html>
