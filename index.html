<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camera App with Lock</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
      touch-action: none;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
    }

    #lockScreen {
      position: fixed;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle at center, #111 0%, #000 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    #display {
      font-size: 2em;
      background: rgba(30, 30, 30, 0.8);
      color: #fff; /* changed from #0f0 to white */
      border: 2px solid #fff; /* changed from #0f0 to white */
      padding: 10px;
      text-align: center;
      border-radius: 10px;
      width: 220px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px #fff8; /* changed shadow to white */
    }

    .btn {
      width: 60px;
      height: 60px;
      margin: 5px;
      font-size: 1.5em;
      background: linear-gradient(to bottom, #222, #111);
      color: white;
      border: 1px solid #444;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      transition: all 0.2s ease;
    }

    .btn:hover {
      background: linear-gradient(to bottom, #333, #222);
      box-shadow: 0 0 10px #fff8; /* white glow instead of green */
      transform: translateY(-2px);
    }

    .btn:active {
      background: linear-gradient(to bottom, #111, #000);
      transform: translateY(1px);
      box-shadow: 0 0 5px #fff4 inset; /* white inset shadow */
    }

    #cameraContainer {
      position: fixed;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      z-index: 0;
      display: none;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #overlayImage {
      position: absolute;
      top: 50%;
      left: 50%;
      max-width: 80%;
      max-height: 80%;
      transform: translate(-50%, -50%);
      z-index: 5;
      touch-action: none;
      display: none;
      transition: transform 0.2s ease;
    }

    #controls {
      position: fixed;
      bottom: 15px;
      left: 15px;
      z-index: 10;
      display: none;
      gap: 10px;
      align-items: center;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 15px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }

    #controls button {
      background: linear-gradient(to bottom, #444, #222);
      color: #fff;
      border: none;
      border-radius: 10px;
      height: 34px;
      padding: 0 12px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }

    #controls button:hover {
      background: linear-gradient(to bottom, #666, #333);
      box-shadow: 0 0 10px #fff8; /* white glow on hover */
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100px;
      height: 6px;
      background: #333;
      border-radius: 5px;
      outline: none;
      transition: 0.2s ease;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 18px;
      width: 18px;
      background: #fff; /* changed thumb color to white */
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px #fff8; /* white glow */
      transition: 0.2s ease;
      margin-top: -6px;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: #fff;
      box-shadow: 0 0 15px #fff9;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 6px;
      background: #222;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <!-- Lock Screen -->
  <div id="lockScreen">
    <h2>Enter Password</h2>
    <input type="password" id="display" readonly>
    <div id="keypad">
      <div>
        <button class="btn" onclick="press('1')">1</button>
        <button class="btn" onclick="press('2')">2</button>
        <button class="btn" onclick="press('3')">3</button>
      </div>
      <div>
        <button class="btn" onclick="press('4')">4</button>
        <button class="btn" onclick="press('5')">5</button>
        <button class="btn" onclick="press('6')">6</button>
      </div>
      <div>
        <button class="btn" onclick="press('7')">7</button>
        <button class="btn" onclick="press('8')">8</button>
        <button class="btn" onclick="press('9')">9</button>
      </div>
      <div>
        <button class="btn" onclick="clearDisplay()">C</button>
        <button class="btn" onclick="press('0')">0</button>
        <button class="btn" onclick="checkPassword()">OK</button>
      </div>
    </div>
  </div>

  <!-- Camera Overlay App -->
  <div id="cameraContainer">
    <video id="video" autoplay playsinline muted></video>
  </div>
  <img id="overlayImage" />

  <div id="controls">
    <input id="zoomSlider" type="range" min="0.3" max="3" step="0.01" value="1">
    <input id="opacitySlider" type="range" min="0.1" max="1" step="0.01" value="1">
    <button id="photoBtn">Choose Photo</button>
  </div>

  <script>
    const PASSWORD = "3590";
    let input = "";

    function press(num) {
      input += num;
      document.getElementById("display").value = input;
    }

    function clearDisplay() {
      input = "";
      document.getElementById("display").value = "";
    }

    function checkPassword() {
      if (input === PASSWORD) {
        document.getElementById("lockScreen").style.display = "none";
        document.getElementById("cameraContainer").style.display = "block";
        document.getElementById("controls").style.display = "flex";
        startCamera();
      } else {
        alert("âŒ Wrong password");
        clearDisplay();
      }
    }

    const video = document.getElementById("video");
    const overlay = document.getElementById("overlayImage");
    const zoomSlider = document.getElementById("zoomSlider");
    const opacitySlider = document.getElementById("opacitySlider");
    const photoBtn = document.getElementById("photoBtn");

    let lastTouch = null;
    let scale = 1, startDistance = 0, rotation = 0, startAngle = 0;
    let originX = 0, originY = 0;
    let videoTrack = null;
    let supportsRealZoom = false;

    function applyTransform() {
      overlay.style.transform =
        `translate(-50%, -50%) translate(${originX}px, ${originY}px) scale(${scale}) rotate(${rotation}deg)`;
    }

    const savedOverlay = localStorage.getItem("savedOverlay");
    const savedPosition = JSON.parse(localStorage.getItem("savedPosition"));
    const savedScale = localStorage.getItem("savedScale");
    const savedRotation = localStorage.getItem("savedRotation");

    if (savedOverlay) {
      overlay.src = savedOverlay;
      overlay.style.display = "block";
    }

    if (savedPosition) {
      originX = savedPosition.x;
      originY = savedPosition.y;
    }

    if (savedScale) scale = savedScale;
    if (savedRotation) rotation = savedRotation;

    applyTransform();

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { exact: "environment" } }
        });
        video.srcObject = stream;

        videoTrack = stream.getVideoTracks()[0];
        const capabilities = videoTrack.getCapabilities();
        const settings = videoTrack.getSettings();

        if (capabilities.zoom) {
          supportsRealZoom = true;
          zoomSlider.min = capabilities.zoom.min;
          zoomSlider.max = capabilities.zoom.max;
          zoomSlider.step = capabilities.zoom.step;
          zoomSlider.value = settings.zoom || capabilities.zoom.min;

          zoomSlider.addEventListener("input", () => {
            videoTrack.applyConstraints({
              advanced: [{ zoom: parseFloat(zoomSlider.value) }]
            });
          });
        } else {
          zoomSlider.addEventListener("input", () => {
            scale = zoomSlider.value;
            localStorage.setItem("savedScale", scale);
            applyTransform();
          });
        }
      } catch (e) {
        console.error("Camera error:", e);
        alert("Could not access the rear camera.");
      }
    }

    opacitySlider.addEventListener("input", () => {
      overlay.style.opacity = opacitySlider.value;
    });

    function choosePhoto() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";
      input.onchange = e => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            const dataURL = event.target.result;
            overlay.src = dataURL;
            overlay.style.display = "block";
            originX = 0;
            originY = 0;
            scale = 1;
            rotation = 0;
            applyTransform();
            localStorage.setItem("savedOverlay", dataURL);
            localStorage.setItem("savedPosition", JSON.stringify({ x: originX, y: originY }));
            localStorage.setItem("savedScale", scale);
            localStorage.setItem("savedRotation", rotation);
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    }

    photoBtn.addEventListener("click", choosePhoto);

    overlay.addEventListener("touchstart", e => {
      if (e.touches.length === 1) {
        lastTouch = e.touches[0];
      } else if (e.touches.length === 2) {
        const [t1, t2] = e.touches;
        const dx = t1.clientX - t2.clientX;
        const dy = t1.clientY - t2.clientY;
        startDistance = Math.hypot(dx, dy);
        startAngle = Math.atan2(dy, dx) * (180 / Math.PI);
      }
    });

    overlay.addEventListener("touchmove", e => {
      e.preventDefault();
      if (e.touches.length === 1 && lastTouch) {
        const dx = e.touches[0].clientX - lastTouch.clientX;
        const dy = e.touches[0].clientY - lastTouch.clientY;
        originX += dx;
        originY += dy;
        lastTouch = e.touches[0];
        localStorage.setItem("savedPosition", JSON.stringify({ x: originX, y: originY }));
        applyTransform();
      } else if (e.touches.length === 2) {
        const [t1, t2] = e.touches;
        const dx = t1.clientX - t2.clientX;
        const dy = t1.clientY - t2.clientY;
        const newDistance = Math.hypot(dx, dy);
        const newAngle = Math.atan2(dy, dx) * (180 / Math.PI);

        const zoomFactor = newDistance / startDistance;
        scale *= zoomFactor;
        scale = Math.max(0.1, Math.min(scale, 10));
        rotation += newAngle - startAngle;
        startDistance = newDistance;
        startAngle = newAngle;

        localStorage.setItem("savedScale", scale);
        localStorage.setItem("savedRotation", rotation);
        applyTransform();
      }
    }, { passive: false });

    let lastTap = 0;
    overlay.addEventListener("touchend", () => {
      const now = Date.now();
      if (now - lastTap < 300) {
        originX = 0;
        originY = 0;
        scale = 1;
        rotation = 0;
        localStorage.setItem("savedPosition", JSON.stringify({ x: originX, y: originY }));
        localStorage.setItem("savedScale", scale);
        localStorage.setItem("savedRotation", rotation);
        applyTransform();
      }
      lastTap = now;
    });

    let pressTimer;
    document.body.addEventListener("touchstart", () => {
      pressTimer = setTimeout(choosePhoto, 1500);
    });
    document.body.addEventListener("touchend", () => {
      clearTimeout(pressTimer);
    });
  </script>
</body>
</html>
