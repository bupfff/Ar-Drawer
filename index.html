<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Camera App with Lock</title>
<style>
html, body {margin:0; padding:0; overflow:hidden; background:black; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color:white; touch-action:none;}
#lockScreen {position:fixed; width:100vw; height:100vh; background: radial-gradient(circle at center, #111 0%, #000 100%); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1000;}
#display {font-size:2em; background: rgba(30,30,30,0.8); color:#fff; border:2px solid #fff; padding:10px; text-align:center; border-radius:10px; width:220px; margin-bottom:20px; box-shadow:0 0 10px #fff8;}
.btn {width:60px; height:60px; margin:5px; font-size:1.5em; background:linear-gradient(to bottom,#222,#111); color:white; border:1px solid #444; border-radius:12px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.5); transition: all 0.2s ease;}
.btn:hover {background:linear-gradient(to bottom,#333,#222); box-shadow:0 0 10px #fff8; transform: translateY(-2px);}
.btn:active {background:linear-gradient(to bottom,#111,#000); transform:translateY(1px); box-shadow:0 0 5px #fff4 inset;}
#keypad div {display:flex; justify-content:center;}

#cameraContainer {position:fixed; width:100vw; height:100vh; top:0; left:0; z-index:0; display:none;}
video {width:100%; height:100%; object-fit:cover;}
#overlayImage {position:absolute; top:50%; left:50%; max-width:80%; max-height:80%; transform:translate(-50%,-50%); z-index:5; touch-action:none; display:none; transition:transform 0.05s ease;}

#controls {position:fixed; bottom:10px; left:50%; transform:translateX(-50%); display:flex; gap:5px; align-items:center; z-index:10; max-width:95vw; flex-wrap:wrap;}
#controls button {background:linear-gradient(to bottom,#444,#222); color:#fff; border:none; border-radius:10px; height:34px; padding:0 10px; font-size:14px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.4);}
#controls button:hover {background:linear-gradient(to bottom,#666,#333); box-shadow:0 0 10px #fff8;}
input[type="range"] {-webkit-appearance:none; width:80px; height:6px; background:#333; border-radius:5px; outline:none;}
input[type="range"]::-webkit-slider-thumb {-webkit-appearance:none; height:18px; width:18px; background:#fff; border-radius:50%; cursor:pointer; box-shadow:0 0 10px #fff8; margin-top:-6px; transition:0.2s ease;}
input[type="range"]::-webkit-slider-thumb:hover {box-shadow:0 0 15px #fff9;}
input[type="range"]::-webkit-slider-runnable-track {height:6px; background:#222; border-radius:5px;}
</style>
</head>
<body>

<div id="lockScreen">
<h2>Enter Password</h2>
<input type="password" id="display" readonly>
<div id="keypad">
  <div><button class="btn" onclick="press('1')">1</button><button class="btn" onclick="press('2')">2</button><button class="btn" onclick="press('3')">3</button></div>
  <div><button class="btn" onclick="press('4')">4</button><button class="btn" onclick="press('5')">5</button><button class="btn" onclick="press('6')">6</button></div>
  <div><button class="btn" onclick="press('7')">7</button><button class="btn" onclick="press('8')">8</button><button class="btn" onclick="press('9')">9</button></div>
  <div><button class="btn" onclick="clearDisplay()">C</button><button class="btn" onclick="press('0')">0</button><button class="btn" onclick="checkPassword()">OK</button></div>
</div>
</div>

<div id="cameraContainer">
<video id="video" autoplay playsinline muted></video>
</div>
<img id="overlayImage" />

<div id="controls">
<input id="zoomSlider" type="range" min="1" max="3" step="0.01" value="1">
<input id="opacitySlider" type="range" min="0.1" max="1" step="0.01" value="1">
<button id="photoBtn">Photo</button>
<button id="linkZoomBtn">Link Zoom</button>
<button id="resetBtn" title="Reset overlay and camera zoom">Reset</button>
</div>

<script>
/* PASSWORD */
const PASSWORD="3490";
let input="";
function press(n){ input+=n; display.value=input }
function clearDisplay(){ input=""; display.value="" }
function checkPassword(){
  if(input===PASSWORD){
    lockScreen.style.display="none";
    cameraContainer.style.display="block";
    controls.style.display="flex";
    startCamera();
    restoreState();
  } else { clearDisplay(); alert("Wrong password"); }
}

/* ELEMENTS */
const video=document.getElementById("video");
const overlay=document.getElementById("overlayImage");
const zoomSlider=document.getElementById("zoomSlider");
const opacitySlider=document.getElementById("opacitySlider");
const photoBtn=document.getElementById("photoBtn");
const linkZoomBtn=document.getElementById("linkZoomBtn");
const resetBtn=document.getElementById("resetBtn");

/* STATE */
let tx=0,ty=0,ts=1,tr=0; // target
let x=0,y=0,scale=1,rot=0; // smoothed
let lastTouch=null,startDist=0,startAngle=0;
let linkZoom=false;
let track,cap,camMin=1,camMax=3,baseCamZoom=1,baseScale=1;

/* ANIMATION */
function lerp(a,b){ return a+(b-a)*0.2 }
function animate(){
  x=lerp(x,tx); y=lerp(y,ty);
  scale=lerp(scale,ts); rot=lerp(rot,tr);
  overlay.style.transform=`translate(-50%,-50%) translate(${x}px,${y}px) scale(${scale}) rotate(${rot}deg)`;
  requestAnimationFrame(animate);
}
animate();

/* CAMERA */
async function startCamera(){
  try {
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:"environment"}}});
    video.srcObject=stream;
    track=stream.getVideoTracks()[0];
    cap=track.getCapabilities();
    if(cap.zoom){
      camMin=cap.zoom.min; camMax=cap.zoom.max;
      zoomSlider.min=camMin; zoomSlider.max=camMax; zoomSlider.step=cap.zoom.step;
      const initialZoom=track.getSettings().zoom||camMin;
      zoomSlider.value=initialZoom;
      track.applyConstraints({advanced:[{zoom:initialZoom}]});
    } else {
      zoomSlider.min=1; zoomSlider.max=3; zoomSlider.step=0.01; zoomSlider.value=1;
    }
  } catch(e){ alert("Cannot access rear camera."); console.error(e); }
}

/* SLIDERS */
opacitySlider.oninput=()=>{ overlay.style.opacity=opacitySlider.value; saveState(); };
zoomSlider.oninput=()=>{
  const z=parseFloat(zoomSlider.value);
  if(track?.applyConstraints) track.applyConstraints({advanced:[{zoom:z}]});
  if(linkZoom){ ts=baseScale*(z/baseCamZoom); saveState(); }
};

/* LINK ZOOM BUTTON */
linkZoomBtn.onclick=()=>{
  linkZoom=!linkZoom;
  linkZoomBtn.textContent=linkZoom?"Unlink":"Link";
  if(linkZoom){
    baseCamZoom=parseFloat(zoomSlider.value);
    baseScale=ts;
  }
};

/* PHOTO PICKER */
photoBtn.onclick=()=>{
  const input=document.createElement("input");
  input.type="file"; input.accept="image/*";
  input.onchange=e=>{
    const file=e.target.files[0]; if(!file) return;
    overlay.src=URL.createObjectURL(file);
    overlay.style.display="block";
    tx=ty=0; ts=scale=1; tr=rot=0; opacitySlider.value=1; overlay.style.opacity=1;
    saveState();
  };
  input.click();
};

/* RESET BUTTON */
resetBtn.onclick=()=>{
  tx=ty=0; ts=scale=1; tr=rot=0; overlay.style.opacity=1; opacitySlider.value=1;
  if(track?.applyConstraints) track.applyConstraints({advanced:[{zoom:camMin}]});
  zoomSlider.value=camMin;
  saveState();
};

/* TOUCH HANDLING */
overlay.addEventListener("touchstart",e=>{
  if(e.touches.length===1 && !linkZoom) lastTouch=e.touches[0];
  if(e.touches.length===2){
    const [a,b]=e.touches;
    startDist=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
    startAngle=Math.atan2(a.clientY-b.clientY,a.clientX-b.clientX);
    baseCamZoom=parseFloat(zoomSlider.value); baseScale=ts;
  }
});

overlay.addEventListener("touchmove",e=>{
  e.preventDefault();
  if(e.touches.length===1 && lastTouch && !linkZoom){
    tx+=e.touches[0].clientX-lastTouch.clientX;
    ty+=e.touches[0].clientY-lastTouch.clientY;
    lastTouch=e.touches[0];
  }
  if(e.touches.length===2){
    const [a,b]=e.touches;
    const d=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
    const factor=d/startDist;
    if(linkZoom){
      let newZoom=baseCamZoom*factor;
      newZoom=Math.max(camMin,Math.min(newZoom,camMax));
      if(track?.applyConstraints) track.applyConstraints({advanced:[{zoom:newZoom}]});
      zoomSlider.value=newZoom;
      ts=baseScale*(newZoom/baseCamZoom);
    } else {
      ts=Math.max(0.1,Math.min(ts*factor,10));
      const ang=Math.atan2(a.clientY-b.clientY,a.clientX-b.clientX);
      tr+= (ang-startAngle)*(180/Math.PI);
      startAngle=Math.atan2(a.clientY-b.clientY,a.clientX-b.clientX);
    }
    startDist=d;
  }
},{passive:false});

/* MEMORY */
function saveState(){
  localStorage.setItem("overlayState",JSON.stringify({
    x:tx,y:ty,scale:ts,rot:tr,opacity:overlay.style.opacity,
    zoom:zoomSlider.value,img:overlay.src
  }));
}
function restoreState(){
  const s=JSON.parse(localStorage.getItem("overlayState")||"null");
  if(!s) return;
  tx=s.x; ty=s.y; ts=s.scale; tr=s.rot;
  overlay.style.opacity=s.opacity; overlay.src=s.img; overlay.style.display=s.img?"block":"none";
  zoomSlider.value=s.zoom;
  if(track?.applyConstraints) track.applyConstraints({advanced:[{zoom:parseFloat(s.zoom)}]});
}
</script>
</body>
</html>
